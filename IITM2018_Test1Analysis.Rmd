---
title: "R Notebook"
output:
  html_document:
    df_print: paged
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE,warning=FALSE,message=FALSE,cache = FALSE)
```

```{r echo=FALSE}
library(tidyverse)
#library(zoo)

setwd("C:\\Users\\admin\\Documents\\Madwork\\other\\IITM2018_Placement")

question_points<-read.csv("test_point.csv");
question_points<-question_points %>%
  mutate(QuestionNum=1:n());

vec_CorrectAns<-as.character(question_points$CorrectAns);
vec_QuesPoints<-as.numeric(question_points$Points);

user_responses_main<-read.csv("user_responses.csv");

user_responses<-user_responses_main[,21:40];
user_responses<-apply(user_responses,2,as.character);

num_users<-nrow(user_responses);
num_questions<-ncol(user_responses);

user_isCorrect<-matrix(0,nrow=num_users,ncol=num_questions);
for(rowInx in 1:num_users){
  user_isCorrect[rowInx,]=as.numeric(user_responses[rowInx,]==vec_CorrectAns);
};

easy_questionIndex<-which(vec_QuesPoints==1);
medium_questionIndex<-which(vec_QuesPoints==2);
hard_questionIndex<-which(vec_QuesPoints==3);

exp_easy=0.8;
exp_medium=0.6;
exp_hard=0.4;
concentration=50;# a+b
```

```{r}
posterior_shapevals<-function(mean,Y,N){
  # Y = Responders ; N = sampleSize
  # mean=a/a+b; concentration=a+b; refer wikipedia
  a_prior=mean*concentration;b_prior=concentration-a_prior;
  
  a_posterior=a_prior+Y;
  b_posterior=b_prior+N-Y;
  return(c(a_posterior,b_posterior));
}

question_posterior<-function(quesNum,mean_prior){
  Y=sum(user_isCorrect[,quesNum]);
  return(posterior_shapevals(mean_prior,Y,num_users));
}


```

## Prior distribution for probability of solving (Easy) question correctly

Expected probability of answering correctly (from Prior belief) are 

  * An easy question, Exp =  `r exp_easy`
  * A medium question, Exp = `r exp_medium`
  * A hard question, Exp= `r exp_hard`

## Probability distributions for solving correctly
```{r, fig.width=4,fig.height=2}
questions<-1:20
plots<-list();
for(q in questions){
  exp_prob=0.8;
  if(vec_QuesPoints[q]==2){
    exp_prob=exp_medium;
  }
  else if(vec_QuesPoints[q]==3){
    exp_prob=exp_hard;
  }
    
  belief<-c(exp_prob*concentration,(1-exp_prob)*concentration);
  postEvd<-question_posterior(q,exp_prob);
  
  df<-gather(data.frame(priori=rbeta(10000,belief[1],belief[2]),posteriori=rbeta(10000,postEvd[1],postEvd[2])));
  
  title_txt=paste("Ques ",q);
  gg<-ggplot(df);
  g<-gg+geom_density(aes(x=value,color=key),size=2)+
    xlim(0,1)+theme_bw()+
    labs(title=title_txt,xlab="Probability of answering correctly",ylab="");
#  plots<-c(plots,list(g));
#  plots[q]=g;
  print(g);
}
#grid.arrange(plots[1],plots[2])

```

TODO :

  * Explanation of conjugate pair
  * table showing prior category of question and posterior category
  * Note on the tight CrI
  * take samples and identify in howmany cases, the prior differs from posteriori
  * Can we do MCMC and get a posterior distribution and compare the 2 posteriori's??
